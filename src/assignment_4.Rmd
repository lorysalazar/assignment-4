---
title: "Assignment 4"
author: "Lory Salazar"
date: "11/17/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
library(tidyverse)
library(here)
library(lubridate)
library(effsize)
library(kableExtra)
```

## 1. Introduction
intro here
A 4 - 5 sentence "mini-introduction" to what this study is exploring, including basic background information about the subject, site and study (with citations as needed), and a brief overview of what is included in the exploratory report. You should probably do this last.

## 2. Data and analyses
Snowshoe hare physical data were collected and made available by Knut Kielland and four co-creators at the Bonanza Creek Long Term Ecological Research (LTER)  site in Fairbanks, Alaska. The data contain observations for 3197 snowshoe hares (*Lepus americanus*), collected over 13 years (1999-2012). Following exploratory data visualization, weight between male and female juvenile hares are compared with two-sample t-tests. Differences between groups are described by Cohenâ€™s d effect size. The relationship between hind foot length and weight is explored by simple linear regression. All analyses are in R version 4.0.2 using RStudio version 1.3.1056.

Kielland, K., F.S. Chapin, R.W. Ruess, and Bonanza Creek LTER. 2017. Snowshoe hare physical data in Bonanza Creek Experimental Forest: 1999-Present ver 22. Environmental Data Initiative. https://doi.org/10.6073/pasta/03dce4856d79b91557d8e6ce2cbcdc14


## 3. Preliminary results

First, I read in the snowshoe hares dataset before I can then begin data wrangling.
```{r}
bonanza_hares <- read.csv(here("data","bonanza_hares.csv"))
```

### Annual juvenile hare trappings by year 

I begin by wrangling the data. First, I add a column to include the year. Next, I use the count and filter functions to create a subset of the data that has counts for the juvenile hares. Lastly, I created a bar graph to plot the number of juvenile hares per year.
```{r}
bonanza_hares_dates <- bonanza_hares %>% 
  mutate(date_updated = mdy(date)) %>% 
  mutate(year = year(date_updated))

age_count <- bonanza_hares_dates %>% 
  count(age, year) %>% 
  filter(age == "j")

ggplot(data = age_count, aes(x = year, y = n)) +
  geom_col() +
  labs(x = "Time (years)",
       y = "Number of juvenile hare trappings",
       title = "Total number of juvenile hare trappings by year (Bonanza Creek, 1999-2012)") +
  scale_y_continuous(breaks = c(20,40,60,80,100,120,140)) +
  theme_minimal() 
```

**Figure 1.** Counts of snowshoe hare trappings for juvenile hares (*Lepus americanus*), measured by times (years) from 1999-2012. Data: Kielland et al. (2017).

Explain/describe major takeaways here:


### Juvenile hare weights by sex and site

juvenile hare weights by sex and site

```{r}
juv_sex_hares <- bonanza_hares %>% 
  filter(age == "j")

ggplot(data = juv_sex_hares, aes(x = weight)) +
  geom_histogram(aes(fill = sex)) +
  facet_wrap(~grid) +
  labs(x = "Weight (g)",
       y = "Count of juvenile hares",
       title = "Weight of juvenile hares by sex and site (Bonanza Creek)")
```

**Figure 2.** Counts of weight (g) for juvenile hares of female. male, and unconfirmed sex by name of trapping grid (bonbs, bonmat, and bonrip). Coral (female), teal (male), and gray (unconfirmed sex) indicate the different counts of weight for each sex at the three sites. Data: Kielland et al. (2017).

Describe main takeaway here

### Comparing juvenile weight by sex

**Table 1.** Descriptive statistics (mean, standard deviation, and sample size) for juvenile snowshoe hares, grouped by sex. Data: Kielland et al. (2017).
```{r}
juv_stats <- juv_sex_hares %>% 
  group_by(sex) %>% 
  summarise(mean = mean(weight, na.rm = TRUE),
            sd = sd(weight, na.rm = TRUE),
            sample_size = n()
            )

juv_stats %>% 
   kable(col.names = c("Sex", "Mean weight (g)", "Standard deviation (g)", "Sample size")) %>% 
  kable_styling(bootstrap_options = "striped", full_width = FALSE)
```

### Two-sample t-test and exploratory graphs
Before running the t-test, I create a few exploratory graphs to explore the assumptions of the t-test. I use a histogram and qqplot to look at the data's normality.

```{r, include = FALSE}
ggplot(data = juv_sex_hares, aes(x = weight)) +
  geom_histogram() +
  facet_wrap(~sex)

ggplot(data = juv_sex_hares, aes(sample = weight)) +
  geom_qq() +
  facet_wrap(~sex)
```


Next, I create vectors of the data of juvenile hares by sex and weight so that I can use them to run a t-test.

```{r}
hares_m <- juv_sex_hares %>% 
  filter(sex == "m") %>% 
  pull(weight)

hares_f <- juv_sex_hares %>% 
  filter(sex == "f") %>% 
  pull(weight)
```

After creating the vectors, I use them to run a t-test. This is a two-sided t-test, in which we ask the question: 

Is there a significant difference in weight between male and female juvenile snowshoe hares?

```{r}
hares_test <- t.test(hares_m, hares_f)
hares_test

cohen.d(hares_m, hares_f, na.rm = TRUE)
```

## Exploring the relationship between hind foot length and weight for juvenile hares

```{r}
ggplot(data = juv_sex_hares, aes(x = hindft, y = weight)) +
  geom_point() +
  labs(x = "Hind foot length (mm)", 
       y = "Weight (g)",
       title = "Relationship between hind foot length and weight in\njuvenile snowshoe hares (Bonanza Creek)") +
  theme_minimal()
```
DESCRIBE GRAPH

Next, I perform linear regression ADD MORE DESCRIPTION HERE

```{r}
hares_lm <- lm(hindft ~ weight, data = juv_sex_hares)

summary(hares_lm)
```

R^2 is 0.2959, which indicates that 30% of variance in hind foot length is explained by weight.

Below, I use broom to tidy the table we got from the linear model and pull out the intercept and coefficient.
```{r}
hares_lm_tidy <- broom::tidy(hares_lm)

hares_int <- hares_lm_tidy$estimate[1] 

hares_coef <- hares_lm_tidy$estimate[2]

hares_lm_out <- broom::glance(hares_lm) 
hares_lm_out
```

Next, I plot the equation.

```{r}
ggplot(data = juv_sex_hares, aes(x = hindft, y = weight)) +
  geom_point(size = 2) +
  geom_smooth(method = "lm",
              color = "red",
              size = 0.5,
              fill = "gray10",
              alpha = 0.5) + # geom_smooth is to add a linear model to a scatterplot
  theme_light() +
  ggpubr::stat_regline_equation(label.x = 50, label.y = 4000)
```

```{r}
hares_cor <- cor.test(juv_sex_hares$hindft, juv_sex_hares$weight)

hares_cor
```

